!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n=n||self).Chain=t()}(this,function(){"use strict";function t(n,t){for(var r in t)n[r]=t[r]}Function.prototype.bind||(Function.prototype.bind=function(i){for(var n=arguments.length,e=Array(1<n?n-1:0),t=1;t<n;t++)e[t-1]=arguments[t];var o=this;return function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];o.apply(i,e.concat(t))}});var i=!1,e=null;function o(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];if(this instanceof o)this.functions=[],this.args=[],this.add.apply(this,t);else{if(arguments.length)throw new Error("请加上 new 关键字，如果你想使用表达式语法请不要传入参数");i=!0,e=new o}}t(o.prototype,{add:function(n){for(var t=0;t<arguments.length;t++){var r=arguments[t],i=void 0;if(r.constructor===u)i=r.args,r=r.fn;else if("function"!=typeof r)throw new Error("你传入的参数不是一个函数");this.functions.push(r),this.args.push(i)}return this},go:function(n){function u(){var n=++u.currentIndex,t=u.currentChain,r=void 0;if(n>=t.args.length||"running"!==u.state)return u.state="interrupted";for(var i=arguments.length,e=Array(i),o=0;o<i;o++)e[o]=arguments[o];void 0===(r=t.args[n])&&(r=e),t.functions[n].apply(t,r.concat(u))}return t(u,{state:"running",currentChain:this,currentIndex:-1,switchTo:function(n,t){if("function"==typeof n)this.currentIndex=-1,this.currentChain=new o(n),this();else{if(n.constructor!==o)throw new Error("不能切换到一个非函数链对象上");this.currentIndex=void 0===t?-1:--t,this.currentChain=n,this()}}.bind(u),skip:function(n){this.currentIndex+=n,this()}.bind(u),stop:function(){this.state="interrupted",this()}.bind(u)}),u.apply(null,arguments),this}}),o.end=function(){return i=!1,e},o.go=function(){i=!1;for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return e.go.apply(e,t)};var n=Function.prototype.valueOf;function u(n,t){this.fn=n,this.args=t}return t(Function.prototype,{args:function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return new u(this,t)},valueOf:function(){return i?(i=!1,e.functions.push(this),e.args.push(void 0),!(i=!0)):n.call(this)}}),u.prototype.valueOf=function(){return!i||(i=!1,e.functions.push(this.fn),e.args.push(this.args),!(i=!0))},o});
